<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ChemBuddy AI ‚Äì Premium Chatbot</title>
  <link rel="icon" href="data:,">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --cb-bg: #121826;
      --cb-bot-bubble: #1F2937;
      --cb-user-bubble: #2563EB;
      --cb-text: #F1F5F9;
      --cb-accent: #0EA5E9;
      --cb-font: 'Poppins', sans-serif;
      --cb-radius: 16px;
      --cb-timestamp: #94a3b8;
    }
    .light-mode {
      --cb-bg: #F8FAFC;
      --cb-bot-bubble: #E2E8F0;
      --cb-user-bubble: #3B82F6;
      --cb-text: #1E293B;
      --cb-accent: #2563EB;
      --cb-timestamp: #64748B;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    html,body{
      width:100%;height:100%;
      font-family:var(--cb-font);
      background:var(--cb-bg);
      color:var(--cb-text);
      overflow:hidden;
      transition:background .5s, color .5s;
      position:relative;
    }
    .background-glow{
      position:absolute;inset:0;
      background:
        radial-gradient(circle at center,rgba(14,165,233,0.1),transparent 70%),
        radial-gradient(circle at 20% 30%,rgba(14,165,233,0.05),transparent 50%),
        radial-gradient(circle at 80% 70%,rgba(14,165,233,0.05),transparent 50%);
      z-index:-1;pointer-events:none;
    }
    .hero{
      position:absolute;inset:0;
      display:flex;align-items:center;justify-content:center;
      flex-direction:column;text-align:center;padding:20px;
      z-index:1;
    }
    .hero h1{
      font-size:3rem;
      text-shadow:0 0 20px var(--cb-accent);
      animation:glow 2s ease-in-out infinite alternate;
      margin-bottom:20px;
    }
    @keyframes glow{
      to{text-shadow:0 0 40px var(--cb-accent);}
    }
    .launch-btn{
      background:linear-gradient(145deg,var(--cb-accent),#0084ff);
      color:var(--cb-bg);
      padding:15px 32px;
      font-size:1.2rem;
      border:none;
      border-radius:30px;
      cursor:pointer;
      box-shadow:0 0 25px var(--cb-accent);
      transition:transform .2s,box-shadow .2s;
    }
    .launch-btn:hover{
      transform:scale(1.05);
      box-shadow:0 0 65px var(--cb-accent);
    }
    .chat-bubble{
      position:fixed;
      bottom:24px;right:24px;
      width:64px;height:64px;
      border-radius:50%;
      background:var(--cb-accent);
      box-shadow:0 4px 12px rgba(0,0,0,0.4);
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;
      z-index:2;
      transition:transform .2s;
    }
    .chat-bubble:hover{transform:scale(1.1);}
    .chat-bubble img{width:32px;height:32px;}
    #historyPanel{
      position:fixed;
      top:60px; right:20px;
      width:300px;
      max-height:calc(100vh-80px);
      background:var(--cb-bg);
      color:var(--cb-text);
      padding:15px;
      border-radius:10px;
      box-shadow:0 4px 10px rgba(0,0,0,0.4);
      transform:translateX(150%);
      transition:transform .3s;
      z-index:9999;
      overflow-y:auto;
    }
    #historyPanel.open{transform:translateX(0);}
    .history-item{
      margin:6px 0;
      padding:6px 10px;
      background:var(--cb-bot-bubble);
      border-radius:6px;
      display:flex;align-items:center;justify-content:space-between;
      cursor:pointer;
      transition:background .2s;
    }
    .history-item:hover{background:#334155;}
    .cb-header-btn{
      background:transparent;border:none;color:#fff;font-size:1.1rem;margin-left:8px;
      cursor:pointer;
    }
  </style>
</head>
<body>
  <div class="background-glow"></div>
  <div class="hero">
    <h1>Welcome to ChemBuddy AI</h1>
    <button class="launch-btn" onclick="openChatWindow()">üí¨ Launch Full Chat</button>
  </div>
  <div class="chat-bubble" onclick="toggleEmbeddedChat()">
    <img src="https://img.icons8.com/ios-filled/50/ffffff/chat.png" alt="Chat"/>
  </div>
  <div id="historyPanel"><h3>Chat History</h3><div id="historyList"></div></div>

  <!-- Botpress Widget -->
  <script src="https://cdn.botpress.cloud/webchat/v3/inject.js"></script>
  <script>
    const sessions = JSON.parse(localStorage.getItem('cbHistory') || '[]');
    let currentSession = [], embedded = false, lang = 'en';

    function createSpeechKit() {
      const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      return () => ({ Recognition, speechSynthesis: window.speechSynthesis });
    }

    function openChatWindow() {
      window.open("https://cdn.botpress.cloud/webchat/v3.0/shareable.html?configUrl=https://files.bpcontent.cloud/2025/05/25/15/20250525152507-LXHIPHJ0.json",
        "ChemBuddy Chat", "width=600,height=800,resizable=yes");
    }

    function toggleEmbeddedChat() {
      if (!embedded) {
        embedded = true;
        botpressWebChat.init({
          clientId: 'd552eb7f-b74a-4e66-8b6b-94e6f4c6314f',
          workspaceId: 'wkspace_01JW40M6ZASAZZCN1ZY479ES5E',
          botName: 'ChemBuddy AI',
          showPoweredBy: false,
          hideWidget: true,
          enableAttachments: true,
          enableVoice: true,
          language: lang,
          enableTranscriptDownload: true,
          webSpeechPonyfillFactory: createSpeechKit()
        });
        botpressWebChat.show();
        botpressWebChat.onEvent(event => {
          if (['incoming', 'outgoing'].includes(event.type)) currentSession.push(event);
          if (event.type === 'LIFECYCLE.WEBCHAT_READY') {
            const hdr = document.querySelector('#bp-web-widget .bp-header');
            const btns = document.createElement('div');
            btns.className = 'cb-header-btns';
            btns.innerHTML =
              `<button class="cb-header-btn" onclick="switchTheme()">üåì</button>
               <button class="cb-header-btn" onclick="switchLanguage()">üåê</button>
               <button class="cb-header-btn" onclick="toggleHistory()">‚ãØ</button>`;
            hdr.appendChild(btns);
          }
        });
      } else {
        botpressWebChat.isVisible() ? botpressWebChat.hide() : botpressWebChat.show();
      }
    }

    function switchTheme() {
      document.documentElement.classList.toggle('light-mode');
    }
    function switchLanguage() {
      lang = (lang === 'en') ? 'ur' : 'en';
      botpressWebChat.sendEvent({ type: 'custom', payload: { action: 'CHANGE_LANG', lang } });
    }
    function saveSession() {
      if (currentSession.length) {
        sessions.unshift([...currentSession]);
        localStorage.setItem('cbHistory', JSON.stringify(sessions.slice(0, 10)));
      }
    }
    function renderHistory() {
      const list = document.getElementById('historyList');
      list.innerHTML = sessions.map((s, i) => `
        <div class="history-item">
          <span>Session ${i + 1} (${s.length} msgs)</span>
          <button onclick="deleteSession(${i});event.stopPropagation()">üóëÔ∏è</button>
        </div>`).join('');
      Array.from(list.children).forEach((d, i) => d.ondblclick = () => loadSession(i));
    }
    function deleteSession(i) {
      sessions.splice(i, 1);
      localStorage.setItem('cbHistory', JSON.stringify(sessions));
      renderHistory();
    }
    function loadSession(i) {
      botpressWebChat.sendEvent({ type: 'custom', payload: { action: 'LOAD_SESSION', messages: sessions[i] } });
      toggleHistory(false);
    }
    function toggleHistory(show = true) {
      document.getElementById('historyPanel').classList.toggle('open', show);
      if (show) renderHistory();
    }

    window.addEventListener('load', () => {
      toggleEmbeddedChat();
      setTimeout(() =>
        alert("üëã Welcome to ChemBuddy! Say things like: 'good', 'perfect', 'go ahead', 'ok', 'hello' to try it out!"), 300);
    });
  </script>
</body>
</html>
